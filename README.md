# Lis polarny, proxy popularny

## Что делает

Прокси полярный лис работает как гейтвей, получая запрос на соединение от фронтенда с уникальным uuid в качестве uri,
после чего достаёт из redis информацию о том, на какую развёрнутую ноду клауд-браузера
нужно перенаправлять websocket трафик, и проксирует трафик между клиентом и его персональной нодой.

## Как поднять

В комплекте идёт Dockerfile, из котогоро можно собрать образ.
Для запуска требует задания переменных окружения `REDIS_HOST` и `REDIS_PORT`.

Также, должен быть доступ до redis и до нод.

Можно развернуть в контейнере и пробросить внутрь сеть хоста, в которой подняты другие сервисы. Пример:

`docker run -p8001:8001 --env REDIS_HOST=host.docker.internal --env REDIS_PORT=6379 --add-host host.docker.internal:host-gateway lis-polarny-proxy-popularny`

## Текущиее взаимодействие

На данный момент:

- слушает на 8001 порту
- Ждёт websocket соединение вида `ws://host:port/{uuid}`
- `uuid` -- айдишник токена, выданного пользователю, по которому в redis будет доставаться хост и порт ремоут браузер серва
- В redis пока что ждёт ключ uuid4 (вида `b4a1cff7-63a1-43c2-b5a0-9a3f05451df5`) и значение-строку `host:port`
